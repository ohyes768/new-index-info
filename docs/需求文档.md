# 新股发行信息获取系统 - 需求文档

## 1. 项目概述

### 1.1 项目背景
开发一个自动化工具，帮助投资者及时获取沪深两市的新股发行信息，避免错过打新机会。

### 1.2 项目目标
自动获取未来10天内沪深两市的新股发行信息，并以 Markdown 格式输出到控制台，供 n8n 等自动化工具读取和推送，实现信息获取的自动化。

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 数据获取
- **数据源**: akshare（免费财经数据接口）
- **获取内容**: 沪深两市未来10天内的新股发行信息
- **更新频率**: 手动触发执行

#### 2.1.2 数据展示
需要展示以下信息：

**基本信息**:
- 股票代码
- 股票名称
- 申购代码
- **申购日期** ✅ 新增

**发行相关**:
- 发行价格
- 发行数量
- 申购上限
- 中签率

**上市相关**:
- 上市日期
- **上市地点** ✅ 更新为详细分类（上海-主板、上海-科创板、深圳-主板、深圳-创业板、北交所）

**公司信息**:
- **所属行业** ✅ 已实现
- **公司简介** ✅ 已实现

#### 2.1.3 输出展示
- **输出方式**: Markdown 格式打印到控制台（标准输出）
- **输出内容**: 包含所有新股信息的完整报告
- **集成方式**: 可被 n8n 等自动化工具读取并推送到钉钉等平台

### 2.2 非功能需求

#### 2.2.1 性能要求
- 数据获取时间: < 10秒
- 补充详细信息时间: < 5秒（仅对筛选后的新股）
- 总体执行时间: < 15秒
- **性能优化**: 先筛选后补充信息，避免对所有股票调用API ✅

#### 2.2.2 可靠性要求
- 网络异常时自动重试（最多3次）
- 数据异常时优雅降级
- 详细的日志记录

#### 2.2.3 可维护性要求
- 代码符合规范：单个文件不超过300行
- 清晰的模块划分和文档
- 统一的日志输出

## 3. 技术选型

### 3.1 开发语言
- **Python 3.10+**: 简洁高效，丰富的数据分析库

### 3.2 核心依赖
- **akshare**: 免费财经数据接口
- **pandas**: 数据处理

### 3.3 包管理
- **uv**: 现代化的Python包管理工具
- **虚拟环境**: .venv

### 3.4 自动化集成
- **n8n**: 通过读取标准输出，自动推送到钉钉等平台
- **标准输出**: Markdown 格式，便于解析

## 4. 业务场景

### 4.1 典型使用场景
1. n8n 定时触发 Python 脚本
2. 系统自动获取未来10天的新股信息
3. 生成格式化的 Markdown 报告并输出到控制台
4. n8n 读取输出内容
5. n8n 推送到钉钉群
6. 投资者在钉钉群查看新股信息

### 4.2 特殊场景处理
- **无新股时**: 显示"暂无新股"的友好提示
- **数据异常**: 记录详细日志，跳过异常数据
- **输出格式**: 确保 Markdown 格式正确，便于 n8n 解析

## 5. 用户故事

### 5.1 作为投资者
> 我希望能够及时了解未来有哪些新股可以申购，这样我就不会错过打新的机会。

### 5.2 作为投资者
> 我希望看到新股的详细信息（价格、行业、简介等），这样我可以判断是否值得申购。

### 5.3 作为投资者
> 我希望信息能自动推送到我常用的群聊工具，这样我就不需要主动去查看了。

## 6. 验收标准

### 6.1 功能验收
- ✅ 成功获取未来10天的新股数据
- ✅ 数据包含完整信息（基本信息、发行、上市、公司）
  - 基本信息：股票代码、股票名称、申购代码、申购日期
  - 发行相关：发行价格、发行数量、申购上限、中签率
  - 上市相关：上市日期、详细市场信息（主板/科创板/创业板/北交所）
  - 公司信息：所属行业、公司简介
- ✅ 输出格式为清晰的 Markdown
- ✅ Markdown 正确输出到控制台（可被 n8n 读取）

### 6.2 质量验收
- ✅ 日志正确输出到 logs/ 目录
- ✅ 代码符合架构规范（文件行数、目录结构）
- ✅ 可以通过 scripts/run.bat 正常运行
- ✅ 异常情况有合理的处理和提示

### 6.3 用户体验验收
- ✅ 操作简单，一键执行
- ✅ 输出信息清晰易读
- ✅ 输出格式符合 n8n 解析要求

## 7. 约束条件

### 7.1 技术约束
- 必须使用 Python 开发
- 推荐使用 uv 进行包管理（也可使用 pip）
- 虚拟环境目录名必须是 .venv

### 7.2 规范约束
- 主程序文件不超过 500 行
- 使用强类型数据结构（dataclass）
- 脚本必须放在 scripts/ 目录
- 日志必须输出到 logs/ 目录
- 主程序放在 deploy/ 目录

### 7.3 安全约束
- 不涉及敏感信息存储（由 n8n 端管理 webhook）
- 配置简单，无需额外的环境变量

## 8. 里程碑

### 阶段一：基础框架 ✅
- 需求分析 ✅
- 设计方案 ✅

### 阶段二：核心开发 ✅
- 项目初始化 ✅
- 基础设施层实现 ✅
- 核心服务层实现 ✅

### 阶段三：集成测试 ✅
- 主入口和脚本实现 ✅
- 功能测试 ✅
- 异常处理测试 ✅

### 阶段四：文档完善 ✅
- README.md 编写 ✅
- 使用说明 ✅
- 部署指南 ✅
- 项目结构优化（简化为 3 个文件）✅

### 阶段五：项目维护 ✅
- 移除冗余的分层架构代码 ✅
- 保留 deploy/ 目录作为主程序 ✅
- 更新所有项目文档 ✅
