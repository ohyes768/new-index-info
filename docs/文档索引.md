# 新股发行信息获取系统 - 文档索引

**项目版本**: v1.3.0
**最后更新**: 2026-01-07
**文档状态**: ✅ 完整

---

## 快速导航

### 📋 核心文档
- [产品需求文档(PRD)](#产品需求文档prd)
- [技术设计文档(TDD)](#技术设计文档tdd)
- [数据字典](#数据字典)

### 🚀 快速开始
- [项目概述](#项目概述)
- [安装指南](#安装指南)
- [使用指南](#使用指南)

### 📚 开发文档
- [架构设计](#架构设计)
- [API文档](#api文档)
- [部署指南](#部署指南)

---

## 项目概述

### 项目简介
**新股发行信息获取系统**是一个自动化工具，帮助投资者及时获取**A股和港股**市场的新股发行信息。

### 核心功能
- ✅ **A股新股查询**：获取沪深北交易所的新股信息，分类展示当前可申购和未来14天新股 ✅ [v1.3.0新增] 包含完整的公司简介
- ✅ **港股新股查询**：获取港交所的新股信息，分类展示当前可申购和未来14天新股 ✅ [v1.3.0新增] 包含完整的公司简介
- ✅ **详情页补充**：自动访问详情页，补充所属行业和公司简介信息 ✅ [v1.3.0新增]
- ✅ **Markdown输出**：格式化输出，便于n8n集成
- ✅ **自动化推送**：支持钉钉等平台自动推送

### 技术栈
- **开发语言**: Python 3.10+
- **A股数据源**: akshare（免费API）
- **港股数据源**: 新浪财经网页抓取
- **包管理工具**: uv
- **自动化集成**: n8n

---

## 产品需求文档(PRD)

### 文档信息
- **文件名**: [需求文档.md](./需求文档.md)
- **版本**: v1.3.0
- **最后更新**: 2026-01-07

### 内容概要

#### 1. 项目概述
- 项目背景和目标
- 支持的市场（A股 + 港股）
- 变更记录

#### 2. 功能需求
- **2.1 A股数据获取**
  - 数据源：akshare
  - 获取内容：未来10天新股信息
  - ✅ [v1.3.0新增] 补充公司简介（直接使用主营业务）
- **2.2 港股数据获取**
  - 数据源：新浪财经网页抓取
  - 反爬策略：5秒间隔、随机UA
  - ✅ [v1.3.0新增] 详情页补充（所属行业 + 公司简介）
- **2.3 数据展示**
  - A股字段：代码、名称、价格、行业、公司简介等
  - 港股字段：代码、名称、招股价、集资额、行业、公司简介等
  - ✅ [v1.3.0优化] 公司简介表格化显示，与A股格式统一
- **2.4 输出展示**
  - 格式：Markdown
  - 集成：n8n自动推送
  - ✅ [v1.3.0优化] 日志输出到stderr，核心数据JSON输出到stdout

#### 3. 技术选型
- Python 3.10+
- A股依赖：akshare, pandas
- 港股依赖：requests, beautifulsoup4, lxml
- 包管理：uv

#### 4. 业务场景
- 典型使用流程
- 特殊场景处理
- 用户故事

#### 5. 验收标准
- A股功能验收 ✅
- 港股功能验收 ✅ [v1.1.0新增]
- 质量验收
- 用户体验验收

#### 6-8. 其他章节
- 约束条件
- 里程碑（6个阶段）
- 附录

---

## 技术设计文档(TDD)

### 文档信息
- **文件名**: [技术设计文档.md](./技术设计文档.md)
- **版本**: v1.3.0
- **最后更新**: 2026-01-07

### 内容概要

#### 1. 系统架构
- **1.1 整体架构**
  - 模块化设计
  - Amarket/ 和 Hmarket/ 分离
- **1.2 架构设计原则**
  - 模块独立性
  - 代码复用
  - 可扩展性

#### 2. A股模块设计
- **2.1 数据模型**（NewStockInfo）
- **2.2 核心服务**
  - DataFetcher（数据获取）✅ [v1.3.0优化] 直接使用主营业务作为公司简介
  - DataProcessor（数据处理）
  - MarkdownFormatter（格式化）✅ [v1.3.0优化] 公司简介表格化显示
- **2.3 主入口**（main_simple.py）✅ [v1.3.0优化] 日志输出到stderr，JSON输出到stdout

#### 3. 港股模块设计
- **3.1 数据模型**（HKNewStockInfo）
- **3.2 核心服务**
  - HKDataFetcher（网页抓取）✅ [v1.3.0新增] 详情页补充功能
  - HKDataProcessor（数据处理）
  - HKMarkdownFormatter（格式化）✅ [v1.3.0优化] 公司简介表格化显示
- **3.3 主入口**（hk_main.py）✅ [v1.3.0优化] 日志输出到stderr，JSON输出到stdout

#### 4. 技术栈
- 开发语言和依赖包
- 开发工具

#### 5. 关键技术实现
- **5.1 A股数据获取**
  - akshare接口
  - 补充信息方案
- **5.2 港股网页抓取**
  - 编码处理（GBK）
  - 表格解析
  - 单位转换
  - 反爬策略

#### 6. 错误处理
- 网络异常
- 数据异常
- 网页结构变化

#### 7. 性能优化
- A股：先筛选后补充
- 港股：请求频率限制

#### 8. 安全考虑
- 数据安全
- 网络安全
- 代码安全

#### 9. 部署和运维
- 环境要求
- 安装步骤
- 运行方式
- n8n集成

#### 10-12. 其他章节
- 测试
- 后续优化方向
- 附录

---

## 数据字典

### 文档信息
- **文件名**: [数据字典.md](./数据字典.md)
- **版本**: v1.3.0
- **最后更新**: 2026-01-07

### 内容概要

#### 1. A股数据模型
- **1.1 NewStockInfo类定义**
- **1.2 字段说明**
  - 13个字段的详细信息
  - 字段类型、必填性、说明、示例
  - ✅ [v1.3.0更新] company_intro数据源优化说明
- **1.3 market字段枚举值**
  - 上海-主板/科创板
  - 深圳-主板/创业板
  - 北京-北交所

#### 2. 港股数据模型
- **2.1 HKNewStockInfo类定义**
- **2.2 字段说明**
  - 12个字段的详细信息
  - ✅ [v1.3.0新增] industry和company_intro字段启用说明
- **2.3 数据格式说明**
  - stock_code：5位数字
  - offer_price_range：价格区间
  - raised_amount：港元数值
  - subscription_date：日期区间处理
- **2.4 数据模型变更** ✅ [v1.3.0新增]
  - 港股字段补充详情
  - A股字段变更详情
  - 输出格式统一说明

#### 3. 数据转换规则
- **3.1 A股数据转换**
  - akshare → NewStockInfo映射
- **3.2 港股数据转换**
  - HTML列索引 → HKNewStockInfo映射
  - 单位转换逻辑

#### 4. 数据验证规则
- A股验证规则
- 港股验证规则

#### 5. 输出数据格式
- Markdown输出示例（A股）
- Markdown输出示例（港股）

#### 6. 数据流向
- A股数据流
- 港股数据流

#### 7. 数据质量保证
- 数据源质量评估
- 三级验证机制

#### 8-9. 其他章节
- 数据字典维护
- 附录

---

## 安装指南

### 环境要求
- Python 3.10 或更高版本
- Windows / Linux / macOS
- 网络连接

### 安装步骤

#### 1. 克隆项目
```bash
git clone https://github.com/your-repo/new-index-info.git
cd new-index-info
```

#### 2. 创建虚拟环境
```bash
# 使用 uv（推荐）
uv venv

# 或使用 venv
python -m venv .venv
```

#### 3. 激活虚拟环境
```bash
# Windows
.venv\Scripts\activate

# Linux/Mac
source .venv/bin/activate
```

#### 4. 安装依赖
```bash
# 使用 uv（推荐）
uv pip install -r deploy/requirements.txt

# 或使用 pip
pip install -r deploy/requirements.txt
```

#### 5. 验证安装
```bash
# 测试A股功能
cd deploy && ../.venv/Scripts/python main_simple.py

# 测试港股功能
cd deploy && ../.venv/Scripts/python hk_main.py
```

---

## 使用指南

### A股新股查询

#### Windows
```bash
# 使用启动脚本
scripts\run.bat

# 或直接运行
cd deploy
..\.venv\Scripts\python main_simple.py
```

#### Linux/Mac
```bash
# 使用启动脚本
./scripts/run.sh

# 或直接运行
cd deploy
../.venv/bin/python main_simple.py
```

### 港股新股查询 [v1.1.0新增]

#### Windows
```bash
# 使用启动脚本
scripts\hk_run.bat

# 或直接运行
cd deploy
..\.venv\Scripts\python hk_main.py
```

#### Linux/Mac
```bash
# 使用启动脚本
./scripts/hk_run.sh

# 或直接运行
cd deploy
../.venv/bin/python hk_main.py
```

### 输出示例

#### A股输出
```markdown
# A股新股发行信息

**生成时间**: 2026-01-07 09:00:00
**新股数量**: 3 只

---

## 2026-01-10

### XX科技股份有限公司（688123）

| 项目 | 信息 |
|------|------|
| **申购代码** | 788123 |
| **申购日期** | 2026-01-05 |
| **发行价格** | 25.50元 |
| **上市日期** | 2026-01-10 |
| **上市地点** | 上海-科创板 |
...
```

#### 港股输出
```markdown
# 港股新股发行信息

**生成时间**: 2026-01-07 09:00:00
**新股数量**: 3 只

---

## 2026-01-10

### 腾讯控股有限公司（00700）

| 项目 | 信息 |
|------|------|
| **股票代码** | 00700 |
| **申购日期** | 2026-01-05 |
| **上市日期** | 2026-01-10 |
| **招股价** | 250.00-280.00港元 |
...
```

---

## 架构设计

### 项目结构
```
new-index-info/
├── deploy/                  # 部署目录
│   ├── Amarket/            # A股市场模块
│   │   ├── models.py       # 数据模型
│   │   ├── services.py     # 核心服务
│   │   └── main_simple.py  # 主入口
│   ├── Hmarket/            # 港股市场模块 [v1.1.0新增]
│   │   ├── hk_models.py    # 数据模型
│   │   ├── hk_services.py  # 核心服务
│   │   └── hk_main.py      # 主入口
│   └── requirements.txt    # 依赖包列表
├── scripts/                # 启动脚本
│   ├── run.bat/sh         # A股启动脚本
│   └── hk_run.bat/sh      # 港股启动脚本 [v1.1.0新增]
├── docs/                   # 文档目录
│   ├── 需求文档.md
│   ├── 技术设计文档.md
│   ├── 数据字典.md
│   └── 文档索引.md        # 本文档
├── discuss/               # 讨论文档
├── logs/                  # 日志目录
└── README.md             # 项目说明
```

### 模块说明

#### A股模块（Amarket）
- **models.py**: 定义NewStockInfo数据类
- **services.py**:
  - DataFetcher: 从akshare获取数据
  - DataProcessor: 验证和筛选数据
  - MarkdownFormatter: 格式化输出
- **main_simple.py**: 主入口程序

#### 港股模块（Hmarket）[v1.1.0新增]
- **hk_models.py**: 定义HKNewStockInfo数据类
- **hk_services.py**:
  - HKDataFetcher: 从新浪财经抓取数据
  - HKDataProcessor: 验证和筛选数据
  - HKMarkdownFormatter: 格式化输出
- **hk_main.py**: 主入口程序

---

## API文档

### A股模块API

#### DataFetcher
```python
class DataFetcher:
    def fetch_new_stocks(self) -> List[NewStockInfo]:
        """获取A股新股数据"""
```

#### DataProcessor
```python
class DataProcessor:
    def __init__(self, future_days: int = 10):
        """初始化处理器"""

    def validate_data(self, stocks: List[NewStockInfo]) -> List[NewStockInfo]:
        """验证数据完整性"""

    def filter_future_stocks(self, stocks: List[NewStockInfo]) -> List[NewStockInfo]:
        """筛选未来N天内的新股"""
```

#### MarkdownFormatter
```python
class MarkdownFormatter:
    def format_new_stocks(self, stocks: List[NewStockInfo]) -> str:
        """格式化为Markdown"""
```

### 港股模块API [v1.1.0新增]

#### HKDataFetcher
```python
class HKDataFetcher:
    def __init__(self, timeout: int = 10, min_interval: int = 5):
        """初始化获取器"""

    def fetch_hk_new_stocks(self) -> List[HKNewStockInfo]:
        """获取港股新股数据（网页抓取）"""
```

#### HKDataProcessor
```python
class HKDataProcessor:
    def __init__(self, future_days: int = 10):
        """初始化处理器"""

    def validate_data(self, stocks: List[HKNewStockInfo]) -> List[HKNewStockInfo]:
        """验证数据完整性"""

    def filter_future_stocks(self, stocks: List[HKNewStockInfo]) -> List[HKNewStockInfo]:
        """筛选未来N天内的新股"""
```

#### HKMarkdownFormatter
```python
class HKMarkdownFormatter:
    def format_new_stocks(self, stocks: List[HKNewStockInfo]) -> str:
        """格式化为Markdown"""
```

---

## 部署指南

### n8n集成

#### 创建A股新股节点
1. 添加"Execute Command"节点
2. 配置命令：
   ```bash
   cd /path/to/new-index-info/deploy && ../.venv/bin/python main_simple.py
   ```
3. 设置定时任务：每天早上9:00

#### 创建港股新股节点 [v1.1.0新增]
1. 添加"Execute Command"节点
2. 配置命令：
   ```bash
   cd /path/to/new-index-info/deploy && ../.venv/bin/python hk_main.py
   ```
3. 设置定时任务：每天早上9:00（港股时间）

#### 推送到钉钉
1. 添加"HTTP Request"节点
2. 配置钉钉webhook URL
3. 将命令节点的输出作为请求体

### 定时任务

#### Linux/Mac (crontab)
```bash
# A股新股（每天9:00）
0 9 * * 1-5 cd /path/to/new-index-info && ./scripts/run.sh

# 港股新股（每天9:00）
0 9 * * 1-5 cd /path/to/new-index-info && ./scripts/hk_run.sh
```

#### Windows (任务计划程序)
1. 打开"任务计划程序"
2. 创建基本任务
3. 设置触发器：每天9:00
4. 设置操作：启动程序
   - 程序：`C:\path\to\new-index-info\scripts\run.bat`
   - 或港股：`C:\path\to\new-index-info\scripts\hk_run.bat`

---

## 版本历史

### v1.1.0 (2026-01-07)
**重大更新：新增港股新股功能**

#### 新增功能
- ✅ 港股新股查询功能
- ✅ 新浪财经网页抓取
- ✅ 独立港股模块（Hmarket）
- ✅ 港股启动脚本

#### 架构调整
- ✅ 重构项目结构（Amarket/ 和 Hmarket/）
- ✅ 模块化设计，A 股和港股完全独立
- ✅ 代码优化，提升可维护性

#### 文档更新
- ✅ 更新产品需求文档
- ✅ 更新技术设计文档
- ✅ 新增数据字典
- ✅ 新增文档索引

#### 依赖更新
```txt
+ requests>=2.31.0      # 港股网页抓取
+ beautifulsoup4>=4.12.0  # HTML解析
+ lxml>=5.0.0            # XML/HTML解析引擎
```

### v1.0.0 (2025-12-XX)
**初始版本：A股新股功能**

- ✅ A股新股查询
- ✅ akshare数据接口
- ✅ Markdown格式化输出
- ✅ n8n集成支持

---

## 常见问题

### Q1: 港股数据抓取失败怎么办？
**A1**: 检查以下几点：
1. 网络连接是否正常
2. 新浪财经页面是否可访问
3. 查看日志文件（`logs/hk-new-stock-YYYY-MM-DD.log`）
4. 如果是网页结构变化，需要更新解析逻辑

### Q2: A股数据不准确怎么办？
**A2**: akshare数据来源于公开市场，如有延迟请等待官方更新。

### Q3: 如何修改查询天数？
**A3**: 修改主入口文件中的 `future_days` 参数：
```python
processor = DataProcessor(future_days=10)  # 改为其他天数
```

### Q4: 如何同时查询A股和港股？
**A4**: 在n8n中创建两个独立的"Execute Command"节点，分别调用A股和港股的主程序。

### Q5: 港股的集资额显示不对怎么办？
**A5**: 集资额单位是"百万港元"，系统会自动转换为港元。如果显示异常，检查数据解析逻辑。

---

## 贡献指南

### 代码规范
- Python代码遵循PEP 8规范
- 单个文件不超过300行
- 使用强类型注解（dataclass）
- 详细的注释和文档字符串

### 提交流程
1. Fork项目
2. 创建特性分支
3. 提交代码
4. 创建Pull Request

### 测试要求
- 新功能需要添加测试用例
- 确保现有测试通过
- 测试A股和港股功能

---

## 许可证

本项目采用 MIT 许可证。

---

## 联系方式

- **Issues**: [GitHub Issues](https://github.com/your-repo/new-index-info/issues)
- **Email**: your-email@example.com

---

**文档结束**

© 2026 新股发行信息获取系统 | v1.2.0
