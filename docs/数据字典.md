# 新股发行信息获取系统 - 数据字典

**版本**: v1.2.0
**最后更新**: 2026-01-07
**状态**: ✅ 已实现（A股 + 港股，分类展示 + 筛选逻辑优化）

---

## 变更记录

| 日期 | 版本 | 变更内容 |
|------|------|----------|
| 2026-01-07 | v1.2.0 | 新增日期范围字段（issue_date_range和subscription_date_range） |
| 2026-01-07 | v1.1.0 | 新增港股数据模型，重构A股数据模型 |
| 2025-12-XX | v1.0.0 | 初始版本，A股数据模型 |

---

## 1. A股数据模型

### 1.1 NewStockInfo（A股新股信息）

**所在文件**: `deploy/Amarket/models.py`

**数据结构**:
```python
@dataclass
class NewStockInfo:
    """A股新股信息模型"""
    stock_code: str                    # 股票代码
    stock_name: str                    # 股票名称
    subscription_code: str             # 申购代码
    subscription_date: Optional[datetime]   # 申购日期
    issue_price: Optional[float]             # 发行价格
    issue_amount: Optional[float]            # 发行数量
    subscription_limit: Optional[float]      # 申购上限
    success_rate: Optional[str]              # 中签率
    listing_date: Optional[datetime]         # 上市日期
    market: str = ""                     # 市场分类
    industry: str = ""                   # 所属行业
    company_intro: str = ""              # 公司简介
```

### 1.2 字段说明

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| stock_code | str | ✅ | 股票代码 | "688123" |
| stock_name | str | ✅ | 股票名称 | "XX科技股份有限公司" |
| subscription_code | str | ✅ | 申购代码 | "788123" |
| subscription_date | datetime | ❌ | 申购日期 | 2026-01-05 00:00:00 |
| issue_price | float | ❌ | 发行价格（元） | 25.50 |
| issue_amount | float | ❌ | 发行数量（万股） | 5000.00 |
| subscription_limit | float | ❌ | 申购上限（万股） | 5.00 |
| success_rate | str | ❌ | 中签率 | "0.05%" |
| listing_date | datetime | ❌ | 上市日期 | 2026-01-10 00:00:00 |
| market | str | ❌ | 市场分类 | "上海-科创板" |
| industry | str | ❌ | 所属行业 | "软件和信息技术服务业" |
| company_intro | str | ❌ | 公司简介 | "公司主营业务是..." |

### 1.3 market 字段枚举值

| 值 | 说明 |
|---|------|
| 上海-主板 | 上海证券交易所主板 |
| 上海-科创板 | 上海证券交易所科创板 |
| 深圳-主板 | 深圳证券交易所主板 |
| 深圳-创业板 | 深圳证券交易所创业板 |
| 北京-北交所 | 北京证券交易所 |

---

## 2. 港股数据模型 [v1.1.0新增]

### 2.1 HKNewStockInfo（港股新股信息）

**所在文件**: `deploy/Hmarket/hk_models.py`

**数据结构**:
```python
@dataclass
class HKNewStockInfo:
    """港股新股信息模型"""
    stock_code: str                      # 股票代码
    stock_name: str                      # 股票名称（中文）
    stock_name_en: Optional[str]         # 股票英文名称
    offer_price_range: Optional[str]     # 招股价区间
    raised_amount: Optional[str]         # 集资额（港元）
    offer_shares: Optional[str]          # 发售股数
    subscription_ratio: Optional[str]    # 认购倍数
    subscription_date: Optional[datetime]  # 申购日期
    listing_date: Optional[datetime]        # 上市日期
    market: str = "港股"                 # 市场
    industry: str = ""                   # 所属行业
    company_intro: str = ""              # 公司简介
```

### 2.2 字段说明

| 字段名 | 类型 | 必填 | 说明 | 示例值 |
|--------|------|------|------|--------|
| stock_code | str | ✅ | 股票代码（5位数字） | "00700" |
| stock_name | str | ✅ | 股票名称（中文） | "腾讯控股有限公司" |
| stock_name_en | str | ❌ | 股票英文名称 | "Tencent Holdings Limited" |
| offer_price_range | str | ❌ | 招股价区间（港元） | "250.00-280.00" 或 "待定" |
| raised_amount | str | ❌ | 集资额（港元，字符串格式） | "1000000000" |
| offer_shares | str | ❌ | 发售股数（股） | "10000000" |
| subscription_ratio | str | ❌ | 认购倍数 | "15.50" |
| subscription_date | datetime | ❌ | 申购日期 | 2026-01-05 00:00:00 |
| listing_date | datetime | ❌ | 上市日期 | 2026-01-10 00:00:00 |
| market | str | ❌ | 市场分类 | "港股" |
| industry | str | ❌ | 所属行业 | "" |
| company_intro | str | ❌ | 公司简介 | "" |

### 2.3 数据格式说明

#### stock_code（股票代码）
- 格式：5位数字字符串
- 示例："00700", "09988"
- 注意：可能不足5位，左侧补0

#### offer_price_range（招股价区间）
- 格式1：确定价格 "57.97-57.97"
- 格式2：价格区间 "165.00-151.00"
- 格式3：待定（无价格）→ 显示为"待定"

#### raised_amount（集资额）
- 存储格式：字符串形式的港元数值
- 原始数据：百万港元（从新浪财经获取）
- 转换逻辑：
  ```python
  # 原始：1000（百万港元）
  # 转换：1000 * 1000000 = 1000000000（港元）
  ```
- 显示格式：
  - >= 1亿港元：显示为 "X.XX亿港元"
  - >= 1万港元：显示为 "X万港元"
  - < 1万港元：显示为 "X港元"

#### offer_shares（发售股数）
- 存储格式：字符串形式的股数
- 显示格式：
  - >= 1亿股：显示为 "X.XX亿股"
  - >= 1万股：显示为 "X万股"
  - < 1万股：显示为 "X股"

#### subscription_date（申购日期）
- 格式：可能是单个日期或日期区间
- 单个日期："2026-01-05"
- 日期区间："2025-12-31至2026-01-06"
- 处理逻辑：如果是区间，取第一个日期

---

## 3. 数据转换规则

### 3.1 A股数据转换

#### 从 akshare 到 NewStockInfo

| akshare字段 | NewStockInfo字段 | 转换规则 |
|-------------|------------------|----------|
| code | stock_code | 直接映射 |
| name | stock_name | 直接映射 |
| subscription_code | subscription_code | 直接映射 |
| issue_date | subscription_date | 字符串转datetime |
| issue_price | issue_price | 字符串转float |
| issue_amount | issue_amount | 字符串转float |
| ... | ... | ... |

### 3.2 港股数据转换 [v1.1.0新增]

#### 从新浪财经HTML到 HKNewStockInfo

| HTML列索引 | HKNewStockInfo字段 | 转换规则 |
|-----------|-------------------|----------|
| 0 | stock_code | 提取文本，去除链接 |
| 1 | stock_name | 提取文本，去除链接 |
| 2 | offer_price_range | 直接映射 |
| 4 | raised_amount | 百万港元 × 1000000 |
| 5 | subscription_date | 如果是区间，取第一个日期 |
| 6 | listing_date | 字符串转datetime |

**特殊处理**:
```python
# 募资额单位转换
amount_million = float(col_4_text.strip())  # 例如：1000（百万港元）
amount_hkd = int(amount_million * 1000000)  # 转换为港元
raised_amount = str(amount_hkd)

# 申购日期区间处理
if "至" in subscription_date_raw:
    subscription_date_raw = subscription_date_raw.split("至")[0]
subscription_date = parse_date(subscription_date_raw.strip())
```

---

## 4. 数据验证规则

### 4.1 A股数据验证

| 验证项 | 规则 | 错误处理 |
|--------|------|----------|
| stock_code | 非空 | 记录警告，跳过 |
| stock_name | 非空 | 记录警告，跳过 |
| listing_date | 非空 | 记录警告，跳过 |
| issue_price | > 0 | 设置为None |
| issue_amount | > 0 | 设置为None |

### 4.2 港股数据验证 [v1.1.0新增]

| 验证项 | 规则 | 错误处理 |
|--------|------|----------|
| stock_code | 非空，5位数字 | 记录警告，跳过 |
| stock_name | 非空 | 记录警告，跳过 |
| listing_date | 非空 | 记录警告，跳过 |
| subscription_date | >= listing_date | 允许（申购可在上市当天或之前） |

---

## 5. 输出数据格式

### 5.1 Markdown输出（A股）

```markdown
# A股新股发行信息

**生成时间**: 2026-01-07 09:00:00
**新股数量**: 3 只

---

## 2026-01-10

### 股票名称（股票代码）

| 项目 | 信息 |
|------|------|
| **申购代码** | XXXXXX |
| **申购日期** | 2026-01-05 |
| **发行价格** | 25.50元 |
| **发行数量** | 5000万股 |
| **申购上限** | 5万股 |
| **中签率** | 0.05% |
| **上市日期** | 2026-01-10 |
| **上市地点** | 上海-科创板 |
| **所属行业** | 软件和信息技术服务业 |

**公司简介**:
...
```

### 5.2 Markdown输出（港股）[v1.1.0新增]

```markdown
# 港股新股发行信息

**生成时间**: 2026-01-07 09:00:00
**新股数量**: 3 只

---

## 2026-01-10

### 股票名称（股票代码）

| 项目 | 信息 |
|------|------|
| **股票代码** | 00700 |
| **申购日期** | 2026-01-05 |
| **上市日期** | 2026-01-10 |
| **招股价** | 250.00-280.00港元 |
| **发售股数** | 1000万股 |
| **集资额** | 25.00亿港元 |
| **上市地点** | 港交所 |
```

---

## 6. 数据流向

### 6.1 A股数据流

```
akshare API
    ↓
NewStockInfo (内存对象)
    ↓
DataProcessor.validate_data()
    ↓
DataProcessor.filter_future_stocks()
    ↓
MarkdownFormatter.format_new_stocks()
    ↓
Markdown字符串 → 标准输出
```

### 6.2 港股数据流 [v1.1.0新增]

```
新浪财经HTML页面
    ↓
requests获取HTML
    ↓
BeautifulSoup解析
    ↓
HKNewStockInfo (内存对象)
    ↓
HKDataProcessor.validate_data()
    ↓
HKDataProcessor.filter_future_stocks()
    ↓
HKMarkdownFormatter.format_new_stocks()
    ↓
Markdown字符串 → 标准输出
```

---

## 7. 数据质量保证

### 7.1 数据源质量

| 数据源 | 更新频率 | 准确性 | 完整性 |
|--------|----------|--------|--------|
| akshare（A股） | 实时 | 高 | 高（需补充） |
| 新浪财经（港股） | 每日 | 高 | 中 |

### 7.2 数据验证机制

**一级验证**：数据获取时
- 检查必需字段是否存在
- 验证数据格式是否正确

**二级验证**：数据处理时
- 验证日期逻辑（申购日期 <= 上市日期）
- 验证数值合理性（价格 > 0）

**三级验证**：输出格式化时
- 检查Markdown格式是否正确
- 确保输出内容完整

---

## 8. 数据字典维护

### 8.1 更新流程

1. 数据模型变更 → 更新本文档
2. 新增字段 → 添加字段说明
3. 删除字段 → 标记为废弃
4. 字段类型变更 → 更新类型说明

### 8.2 版本管理

- 每次数据模型变更后，更新版本号
- 在"变更记录"中记录变更内容
- 保留历史版本的文档（如有必要）

---

## 9. 附录

### 9.1 相关文档
- [产品需求文档(PRD)](./需求文档.md)
- [技术设计文档(TDD)](./技术设计文档.md)
- [文档索引](./文档索引.md) - 待创建

### 9.2 代码位置

**A股数据模型**:
- 文件：`deploy/Amarket/models.py`
- 类：`NewStockInfo`

**港股数据模型**:
- 文件：`deploy/Hmarket/hk_models.py`
- 类：`HKNewStockInfo`

### 9.3 常见问题

**Q1: 为什么A股和港股使用不同的数据模型？**
A1: 因为两个市场的数据结构差异较大，字段名称、数据类型、数据来源都不同，使用独立的数据模型更清晰。

**Q2: raised_amount 为什么用字符串存储？**
A2: 港股的集资额转换后数值较大（亿级），使用字符串避免精度问题，也便于格式化显示。

**Q3: 港股的 industry 和 company_intro 为什么是空的？**
A3: 新浪财经页面不包含这些信息，未来可以添加其他数据源来补充这些字段。

**Q4: 日期字段为什么使用 Optional[datetime]？**
A4: 因为某些数据可能缺失日期信息，使用Optional类型允许为None。

---

**文档结束**
